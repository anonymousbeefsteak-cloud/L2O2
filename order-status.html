<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¨‚å–®ç‹€æ…‹æŸ¥è©¢ - å°ç£å°åƒåº—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slide-in {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out forwards; }
        
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-confirmed { background-color: #dbeafe; color: #1e40af; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸœ å°ç£å°åƒåº—</h1>
                <p class="text-gray-600">è¨‚å–®ç‹€æ…‹æŸ¥è©¢</p>
                <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-3 rounded-full"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <!-- Search Form -->
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    æŸ¥è©¢è¨‚å–®ç‹€æ…‹
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                        <input 
                            type="tel" 
                            id="phoneInput" 
                            placeholder="è«‹è¼¸å…¥è¨‚é¤æ™‚ä½¿ç”¨çš„æ‰‹æ©Ÿè™Ÿç¢¼" 
                            class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                            maxlength="10"
                        >
                        <p class="text-xs text-gray-500 mt-1">è«‹è¼¸å…¥09é–‹é ­çš„10ä½æ‰‹æ©Ÿè™Ÿç¢¼</p>
                    </div>
                    
                    <button 
                        id="searchBtn"
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                        æŸ¥è©¢è¨‚å–®
                    </button>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden text-center py-8">
                <div class="inline-flex items-center">
                    <svg class="animate-spin h-8 w-8 text-blue-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-gray-600">æŸ¥è©¢ä¸­...</span>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">è¨‚å–®è¨˜éŒ„</h3>
                    <span id="resultsCount" class="text-sm text-gray-500"></span>
                </div>
                <div id="ordersList" class="space-y-4">
                    <!-- Orders will be populated here -->
                </div>
            </div>

            <!-- No Results -->
            <div id="noResults" class="hidden text-center py-8">
                <div class="text-6xl mb-4">ğŸ“­</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">æ‰¾ä¸åˆ°è¨‚å–®è¨˜éŒ„</h3>
                <p class="text-gray-600">è«‹ç¢ºèªæ‰‹æ©Ÿè™Ÿç¢¼æ˜¯å¦æ­£ç¢ºï¼Œæˆ–æ‚¨å°šæœªä¸‹è¨‚å–®</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden text-center py-8">
                <div class="text-6xl mb-4">âŒ</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">æŸ¥è©¢å¤±æ•—</h3>
                <p id="errorText" class="text-gray-600"></p>
            </div>
        </div>

        <!-- Info Section -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
                è¨‚å–®ç‹€æ…‹èªªæ˜
            </h3>
            <div class="space-y-3 text-sm text-gray-600">
                <div class="flex items-center">
                    <span class="status-pending px-2 py-1 rounded-full text-xs mr-3">å¾…ç¢ºèª</span>
                    <span>é¤å»³å°šæœªç¢ºèªæ‚¨çš„è¨‚å–®</span>
                </div>
                <div class="flex items-center">
                    <span class="status-confirmed px-2 py-1 rounded-full text-xs mr-3">å·²ç¢ºèª</span>
                    <span>é¤å»³å·²ç¢ºèªè¨‚å–®ï¼Œæº–å‚™ä¸­</span>
                </div>
                <div class="flex items-center">
                    <span class="status-completed px-2 py-1 rounded-full text-xs mr-3">å·²å®Œæˆ</span>
                    <span>è¨‚å–®å·²å®Œæˆï¼Œå¯å‰å¾€å–é¤</span>
                </div>
                <div class="flex items-center">
                    <span class="status-cancelled px-2 py-1 rounded-full text-xs mr-3">å·²å–æ¶ˆ</span>
                    <span>è¨‚å–®å·²å–æ¶ˆ</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-500 text-sm">
            <p>ğŸ“ ç‡Ÿæ¥­æ™‚é–“: 10:00 - 21:00</p>
            <p>ğŸ“ è¯çµ¡é›»è©±: 02-1234-5678</p>
            <p class="mt-2">å°ç£å°åƒåº— Â© 2024</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbx2HTyUZT_qhk0hQLN_rhFshWmnlQYwwwC95cNI6405ZTXFFWiAMQG-7qQ1OZVpTt7ENw/exec?view=orderStatus';
            
            // DOM Elements
            const elements = {
                phoneInput: document.getElementById('phoneInput'),
                searchBtn: document.getElementById('searchBtn'),
                loadingIndicator: document.getElementById('loadingIndicator'),
                resultsSection: document.getElementById('resultsSection'),
                ordersList: document.getElementById('ordersList'),
                resultsCount: document.getElementById('resultsCount'),
                noResults: document.getElementById('noResults'),
                errorMessage: document.getElementById('errorMessage'),
                errorText: document.getElementById('errorText')
            };

            // ç‹€æ…‹æ–‡å­—æ˜ å°„
            const statusTextMap = {
                'pending': 'å¾…ç¢ºèª',
                'confirmed': 'å·²ç¢ºèª',
                'completed': 'å·²å®Œæˆ',
                'cancelled': 'å·²å–æ¶ˆ'
            };

            // ç‹€æ…‹é¡è‰²æ˜ å°„
            const statusClassMap = {
                'pending': 'status-pending',
                'confirmed': 'status-confirmed',
                'completed': 'status-completed',
                'cancelled': 'status-cancelled'
            };

            // æŸ¥è©¢è¨‚å–®
            async function searchOrders() {
                const phone = elements.phoneInput.value.trim();
                
                // é©—è­‰æ‰‹æ©Ÿè™Ÿç¢¼
                if (!phone) {
                    showError('è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼');
                    return;
                }

                if (!/^09\d{8}$/.test(phone)) {
                    showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼ (09é–‹é ­10ä½æ•¸å­—)');
                    return;
                }

                // é¡¯ç¤ºè¼‰å…¥ä¸­
                showLoading();
                hideAllSections();

                try {
                    // ç™¼é€æŸ¥è©¢è«‹æ±‚
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'getOrders',
                            phone: phone
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`ä¼ºæœå™¨éŒ¯èª¤: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.success) {
                        if (result.data && result.data.length > 0) {
                            displayOrders(result.data);
                        } else {
                            showNoResults();
                        }
                    } else {
                        throw new Error(result.message || 'æŸ¥è©¢å¤±æ•—');
                    }
                } catch (error) {
                    console.error('æŸ¥è©¢éŒ¯èª¤:', error);
                    showError(error.message || 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
                } finally {
                    hideLoading();
                }
            }

            // é¡¯ç¤ºè¨‚å–®åˆ—è¡¨
            function displayOrders(orders) {
                // æŒ‰æ™‚é–“å€’åºæ’åˆ—
                orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                elements.ordersList.innerHTML = orders.map(order => {
                    const statusClass = statusClassMap[order.status] || 'status-pending';
                    const statusText = statusTextMap[order.status] || order.status;
                    const orderDate = formatDate(order.createdAt);
                    const pickupTime = formatDate(order.pickupTime);
                    
                    // è§£æè¨‚å–®é …ç›®
                    let items = [];
                    try {
                        items = typeof order.items === 'string' ? JSON.parse(order.items) : order.items;
                    } catch (e) {
                        items = [];
                    }

                    return `
                        <div class="border border-gray-200 rounded-lg p-4 bg-white shadow-sm fade-in">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold text-gray-800">è¨‚å–® #${order.orderId || 'N/A'}</h4>
                                    <p class="text-xs text-gray-500">ä¸‹å–®æ™‚é–“: ${orderDate}</p>
                                </div>
                                <span class="${statusClass} px-3 py-1 rounded-full text-sm font-medium">
                                    ${statusText}
                                </span>
                            </div>
                            
                            <!-- è¨‚å–®é …ç›® -->
                            <div class="mb-3">
                                ${items.map(item => `
                                    <div class="flex justify-between text-sm py-1">
                                        <span class="text-gray-700">
                                            ${item.icon || 'ğŸ½ï¸'} ${item.name} Ã— ${item.quantity}
                                        </span>
                                        <span class="text-gray-900 font-medium">
                                            $${(item.price * item.quantity).toLocaleString()}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- é‡‘é¡ç¸½è¨ˆ -->
                            <div class="border-t pt-2 space-y-1 text-sm">
                                ${order.deliveryFee > 0 ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-600">å¤–é€è²»:</span>
                                    <span>$${order.deliveryFee}</span>
                                </div>
                                ` : ''}
                                <div class="flex justify-between font-bold text-base border-t pt-2 mt-2">
                                    <span>ç¸½é‡‘é¡:</span>
                                    <span>$${order.totalAmount}</span>
                                </div>
                            </div>
                            
                            <!-- å…¶ä»–è³‡è¨Š -->
                            <div class="mt-3 pt-3 border-t border-gray-100 text-xs text-gray-500 space-y-1">
                                <div class="flex justify-between">
                                    <span>å–é¤æ™‚é–“:</span>
                                    <span>${pickupTime}</span>
                                </div>
                                ${order.deliveryAddress ? `
                                <div class="flex justify-between">
                                    <span>å¤–é€åœ°å€:</span>
                                    <span class="text-right">${order.deliveryAddress}</span>
                                </div>
                                ` : ''}
                                ${order.notes ? `
                                <div class="mt-2 p-2 bg-yellow-50 rounded border border-yellow-200">
                                    <span class="font-medium">å‚™è¨»:</span> ${order.notes}
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                elements.resultsCount.textContent = `å…± ${orders.length} ç­†è¨‚å–®`;
                elements.resultsSection.classList.remove('hidden');
                elements.resultsSection.classList.add('animate-slide-in');
            }

            // æ ¼å¼åŒ–æ—¥æœŸ
            function formatDate(dateString) {
                if (!dateString) return 'æœªè¨­å®š';
                const date = new Date(dateString);
                return date.toLocaleString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // UI æ§åˆ¶å‡½æ•¸
            function showLoading() {
                elements.loadingIndicator.classList.remove('hidden');
                elements.searchBtn.disabled = true;
                elements.searchBtn.innerHTML = `
                    <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    æŸ¥è©¢ä¸­...
                `;
            }

            function hideLoading() {
                elements.loadingIndicator.classList.add('hidden');
                elements.searchBtn.disabled = false;
                elements.searchBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                    </svg>
                    æŸ¥è©¢è¨‚å–®
                `;
            }

            function showNoResults() {
                hideAllSections();
                elements.noResults.classList.remove('hidden');
                elements.noResults.classList.add('animate-slide-in');
            }

            function showError(message) {
                hideAllSections();
                elements.errorText.textContent = message;
                elements.errorMessage.classList.remove('hidden');
                elements.errorMessage.classList.add('animate-slide-in');
            }

            function hideAllSections() {
                elements.resultsSection.classList.add('hidden');
                elements.noResults.classList.add('hidden');
                elements.errorMessage.classList.add('hidden');
            }

            // äº‹ä»¶ç›£è½å™¨
            elements.searchBtn.addEventListener('click', searchOrders);
            
            elements.phoneInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchOrders();
                }
            });

            // è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†
            elements.phoneInput.focus();
        });
    </script>
</body>
</html>
