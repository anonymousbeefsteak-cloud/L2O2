<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>å°ç£å°åƒåº— - åº—å®¶ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f7fafc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .print-only { display: none; }
        @media print {
            .no-print { display: none; }
            .print-only { display: block; }
            body { background: white; }
            .order-details { break-inside: avoid; }
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useCallback, useEffect, useMemo } = React;

        // èœå–®é …ç›®
        const MENU_ITEMS = [
            { name: 'æ»·è‚‰é£¯', price: 35, icon: 'ğŸš' },
            { name: 'é›è‚‰é£¯', price: 40, icon: 'ğŸ—' },
            { name: 'èšµä»”ç…', price: 65, icon: 'ğŸ³' },
            { name: 'å¤§è…¸éºµç·š', price: 50, icon: 'ğŸœ' },
            { name: 'çç å¥¶èŒ¶', price: 45, icon: 'ğŸ¥¤' },
            { name: 'é¹½é…¥é›', price: 60, icon: 'ğŸ–' },
            { name: 'ç”œä¸è¾£', price: 40, icon: 'ğŸ¢' },
            { name: 'è‚‰åœ“', price: 45, icon: 'ğŸ¥Ÿ' },
            { name: 'è‡­è±†è…', price: 55, icon: 'ğŸ§†' },
            { name: 'ç‰›è‚‰éºµ', price: 120, icon: 'ğŸ²' }
        ];

        // ç”Ÿæˆæ¸¬è©¦è³‡æ–™
        const generateTestData = () => {
            const orders = [];
            const statuses = ['pending', 'confirmed', 'preparing', 'ready', 'completed'];
            const customers = ['ç‹å°æ˜', 'é™³å°è¯', 'æ—å°ç¾', 'å¼µå°å¼·', 'æå°é›¯', 'é»ƒå°é¾', 'åŠ‰å°å©·'];
            const addresses = ['', 'å°åŒ—å¸‚ä¿¡ç¾©å€å¿ å­æ±è·¯äº”æ®µ100è™Ÿ', 'å°åŒ—å¸‚å¤§å®‰å€ä»æ„›è·¯å››æ®µ50è™Ÿ', ''];
            
            // ç”Ÿæˆéå»30å¤©çš„è³‡æ–™
            for (let i = 0; i < 100; i++) {
                const daysAgo = Math.floor(Math.random() * 30);
                const orderDate = new Date();
                orderDate.setDate(orderDate.getDate() - daysAgo);
                orderDate.setHours(10 + Math.floor(Math.random() * 10), Math.floor(Math.random() * 60));
                
                const itemCount = Math.floor(Math.random() * 4) + 1;
                const items = [];
                let totalAmount = 0;
                
                for (let j = 0; j < itemCount; j++) {
                    const menuItem = MENU_ITEMS[Math.floor(Math.random() * MENU_ITEMS.length)];
                    const quantity = Math.floor(Math.random() * 3) + 1;
                    items.push({
                        name: menuItem.name,
                        price: menuItem.price,
                        quantity: quantity,
                        icon: menuItem.icon
                    });
                    totalAmount += menuItem.price * quantity;
                }
                
                const customerIndex = Math.floor(Math.random() * customers.length);
                const addressIndex = Math.floor(Math.random() * addresses.length);
                const statusIndex = Math.floor(Math.random() * statuses.length);
                
                orders.push({
                    orderId: `ORD${String(1000 + i).slice(1)}`,
                    customerName: customers[customerIndex],
                    customerPhone: `09${String(10000000 + Math.floor(Math.random() * 90000000)).slice(1)}`,
                    items: items,
                    totalAmount: totalAmount,
                    status: statuses[statusIndex],
                    pickupTime: new Date(orderDate.getTime() + 30 * 60000).toISOString(),
                    deliveryAddress: addresses[addressIndex],
                    notes: Math.random() > 0.7 ? 'ä¸è¦åŠ è¾£' : (Math.random() > 0.5 ? 'éœ€è¦é¤å…·' : ''),
                    createdAt: orderDate.toISOString(),
                    confirmedAt: statuses[statusIndex] !== 'pending' ? new Date(orderDate.getTime() + 5 * 60000).toISOString() : null
                });
            }
            
            return orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        };

        // API æœå‹™
        const apiService = {
            getAllOrders: async () => {
                try {
                    // æ¨¡æ“¬ API å‘¼å«å»¶é²
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // è¿”å›æ¸¬è©¦è³‡æ–™
                    return {
                        success: true,
                        data: generateTestData()
                    };
                } catch (error) {
                    console.error('API è«‹æ±‚å¤±æ•—:', error);
                    throw error;
                }
            },

            confirmOrder: async (orderId, adminNotes) => {
                try {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    return { success: true, message: 'è¨‚å–®ç¢ºèªæˆåŠŸ' };
                } catch (error) {
                    console.error('ç¢ºèªè¨‚å–® API å¤±æ•—:', error);
                    throw error;
                }
            },

            updateOrderStatus: async (orderId, status) => {
                try {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    return { success: true, message: 'ç‹€æ…‹æ›´æ–°æˆåŠŸ' };
                } catch (error) {
                    console.error('æ›´æ–°ç‹€æ…‹ API å¤±æ•—:', error);
                    throw error;
                }
            }
        };

        // åŠ è¼‰å‹•ç•«çµ„ä»¶
        const LoadingSpinner = () => (
            <div className="flex items-center justify-center">
                <svg className="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
        );

        // é€šçŸ¥çµ„ä»¶
        const Notification = ({ message, type, visible, onClose }) => {
            if (!visible) return null;
            
            const typeClasses = {
                success: "bg-green-500 text-white",
                error: "bg-red-500 text-white",
                warning: "bg-yellow-500 text-white",
                info: "bg-blue-500 text-white"
            };
            
            return (
                <div className={`fixed top-5 right-5 max-w-sm p-4 rounded-lg shadow-lg z-50 animate-fade-in ${typeClasses[type]}`}>
                    <div className="flex justify-between items-center">
                        <p className="text-sm font-medium whitespace-pre-wrap">{message}</p>
                        <button onClick={onClose} className="ml-4 text-xl font-bold leading-none hover:opacity-70">
                            &times;
                        </button>
                    </div>
                </div>
            );
        };

        // éŠ·å”®çµ±è¨ˆå¡ç‰‡çµ„ä»¶
        const StatCard = ({ title, value, subtitle, icon, color, trend }) => (
            <div className={`stat-card bg-white rounded-lg p-6 border-l-4 ${color} shadow-sm`}>
                <div className="flex justify-between items-start">
                    <div>
                        <p className="text-sm font-medium text-gray-600">{title}</p>
                        <p className="text-2xl font-bold text-gray-900 mt-1">{value}</p>
                        {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
                        {trend && (
                            <p className={`text-xs font-medium mt-2 ${trend.value > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                {trend.value > 0 ? 'â†—' : 'â†˜'} {Math.abs(trend.value)}% {trend.label}
                            </p>
                        )}
                    </div>
                    <div className="text-3xl opacity-80">
                        {icon}
                    </div>
                </div>
            </div>
        );

        // éŠ·å”®çµ±è¨ˆçµ„ä»¶
        const SalesStatistics = ({ orders, currentView, onViewChange }) => {
            const [dateRange, setDateRange] = useState('today');
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));

            // ç²å–æ—¥æœŸç¯„åœ
            const getDateRange = useMemo(() => {
                const now = new Date();
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const startOfYear = new Date(now.getFullYear(), 0, 1);
                
                const [year, month] = selectedMonth.split('-').map(Number);
                const startOfSelectedMonth = new Date(year, month - 1, 1);
                const endOfSelectedMonth = new Date(year, month, 0, 23, 59, 59);

                return {
                    today: { start: startOfDay, end: now },
                    month: { start: startOfMonth, end: now },
                    year: { start: startOfYear, end: now },
                    custom: { start: startOfSelectedMonth, end: endOfSelectedMonth }
                }[dateRange];
            }, [dateRange, selectedMonth]);

            // ç¯©é¸è¨‚å–®
            const filteredOrders = useMemo(() => {
                const { start, end } = getDateRange;
                return orders.filter(order => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= start && orderDate <= end && order.status !== 'cancelled';
                });
            }, [orders, getDateRange]);

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const statistics = useMemo(() => {
                // ç‡Ÿæ¥­é¡çµ±è¨ˆ
                const totalRevenue = filteredOrders.reduce((sum, order) => sum + order.totalAmount, 0);

                // å®¢æ•¸çµ±è¨ˆ
                const customerCount = filteredOrders.length;

                // ç†±é–€å•†å“çµ±è¨ˆ
                const itemSales = {};
                filteredOrders.forEach(order => {
                    order.items.forEach(item => {
                        const itemName = item.name;
                        if (!itemSales[itemName]) {
                            itemSales[itemName] = { quantity: 0, revenue: 0, icon: item.icon };
                        }
                        itemSales[itemName].quantity += item.quantity;
                        itemSales[itemName].revenue += item.price * item.quantity;
                    });
                });

                // è½‰æ›ç‚ºé™£åˆ—ä¸¦æ’åº
                const popularItems = Object.entries(itemSales)
                    .map(([name, data]) => ({ name, ...data }))
                    .sort((a, b) => b.quantity - a.quantity);

                // æ¯æ—¥æ•¸æ“šï¼ˆç”¨æ–¼åœ–è¡¨ï¼‰
                const dailyData = {};
                filteredOrders.forEach(order => {
                    const date = new Date(order.createdAt).toLocaleDateString('zh-TW');
                    if (!dailyData[date]) {
                        dailyData[date] = { revenue: 0, customers: 0, orders: 0 };
                    }
                    dailyData[date].revenue += order.totalAmount;
                    dailyData[date].customers += 1;
                    dailyData[date].orders += 1;
                });

                // æ¯æœˆæ•¸æ“š
                const monthlyData = {};
                filteredOrders.forEach(order => {
                    const month = new Date(order.createdAt).toLocaleDateString('zh-TW', { year: 'numeric', month: 'long' });
                    if (!monthlyData[month]) {
                        monthlyData[month] = { revenue: 0, customers: 0, orders: 0 };
                    }
                    monthlyData[month].revenue += order.totalAmount;
                    monthlyData[month].customers += 1;
                    monthlyData[month].orders += 1;
                });

                return {
                    totalRevenue,
                    customerCount,
                    popularItems,
                    dailyData,
                    monthlyData,
                    averageOrderValue: customerCount > 0 ? totalRevenue / customerCount : 0,
                    totalOrders: filteredOrders.length
                };
            }, [filteredOrders]);

            // åœ–è¡¨æ•¸æ“š - ç‡Ÿæ¥­é¡è¶¨å‹¢
            const revenueChartData = useMemo(() => {
                const dates = Object.keys(statistics.dailyData).sort();
                const revenueData = dates.map(date => statistics.dailyData[date].revenue);
                const customerData = dates.map(date => statistics.dailyData[date].customers);

                return {
                    labels: dates,
                    datasets: [
                        {
                            label: 'æ¯æ—¥ç‡Ÿæ¥­é¡',
                            data: revenueData,
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                };
            }, [statistics.dailyData]);

            // åœ–è¡¨æ•¸æ“š - å®¢æ•¸è¶¨å‹¢
            const customerChartData = useMemo(() => {
                const dates = Object.keys(statistics.dailyData).sort();
                const customerData = dates.map(date => statistics.dailyData[date].customers);

                return {
                    labels: dates,
                    datasets: [
                        {
                            label: 'æ¯æ—¥å®¢æ•¸',
                            data: customerData,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                };
            }, [statistics.dailyData]);

            // ç†±é–€å•†å“åœ–è¡¨æ•¸æ“š
            const popularItemsChartData = useMemo(() => {
                const topItems = statistics.popularItems.slice(0, 8);
                return {
                    labels: topItems.map(item => item.name),
                    datasets: [{
                        label: 'éŠ·å”®æ•¸é‡',
                        data: topItems.map(item => item.quantity),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)',
                            'rgba(83, 102, 255, 0.8)'
                        ]
                    }]
                };
            }, [statistics.popularItems]);

            // æ¯æœˆç‡Ÿæ¥­é¡åœ–è¡¨
            const monthlyRevenueChartData = useMemo(() => {
                const months = Object.keys(statistics.monthlyData).sort();
                const revenueData = months.map(month => statistics.monthlyData[month].revenue);
                
                return {
                    labels: months,
                    datasets: [{
                        label: 'æ¯æœˆç‡Ÿæ¥­é¡',
                        data: revenueData,
                        backgroundColor: 'rgba(139, 69, 19, 0.8)',
                        borderColor: 'rgb(139, 69, 19)',
                        borderWidth: 2
                    }]
                };
            }, [statistics.monthlyData]);

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            };

            const revenueChartOptions = {
                ...chartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'ç‡Ÿæ¥­é¡ ($)'
                        }
                    }
                }
            };

            return (
                <div className="animate-fade-in">
                    <div className="flex items-center mb-6">
                        <button onClick={() => onViewChange('orders')} className="text-gray-600 hover:text-gray-800 mr-3">
                            â† è¿”å›è¨‚å–®ç®¡ç†
                        </button>
                        <h2 className="text-2xl font-bold">éŠ·å”®çµ±è¨ˆå ±è¡¨</h2>
                    </div>

                    {/* æ™‚é–“ç¯„åœé¸æ“‡ */}
                    <div className="bg-white rounded-lg p-4 border border-gray-200 shadow-sm mb-6">
                        <div className="flex flex-wrap gap-4 items-center">
                            <label className="font-medium">çµ±è¨ˆæœŸé–“:</label>
                            <select 
                                value={dateRange} 
                                onChange={(e) => setDateRange(e.target.value)}
                                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                            >
                                <option value="today">ä»Šæ—¥</option>
                                <option value="month">æœ¬æœˆ</option>
                                <option value="year">ä»Šå¹´</option>
                                <option value="custom">é¸æ“‡æœˆä»½</option>
                            </select>
                            
                            {dateRange === 'custom' && (
                                <input
                                    type="month"
                                    value={selectedMonth}
                                    onChange={(e) => setSelectedMonth(e.target.value)}
                                    className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500"
                                />
                            )}
                            
                            <div className="text-sm text-gray-600">
                                å…± {statistics.totalOrders} ç­†è¨‚å–®ï¼Œ{statistics.customerCount} ä½é¡§å®¢
                            </div>
                        </div>
                    </div>

                    {/* çµ±è¨ˆå¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <StatCard
                            title="ç¸½ç‡Ÿæ¥­é¡"
                            value={`$${statistics.totalRevenue.toLocaleString()}`}
                            subtitle={`${dateRange === 'today' ? 'ä»Šæ—¥' : dateRange === 'month' ? 'æœ¬æœˆ' : 'ä»Šå¹´'}ç‡Ÿæ¥­é¡`}
                            icon="ğŸ’°"
                            color="border-l-blue-500"
                        />
                        <StatCard
                            title="ç¸½å®¢æ•¸"
                            value={statistics.customerCount.toLocaleString()}
                            subtitle={`${dateRange === 'today' ? 'ä»Šæ—¥' : dateRange === 'month' ? 'æœ¬æœˆ' : 'ä»Šå¹´'}å®¢æ•¸`}
                            icon="ğŸ‘¥"
                            color="border-l-green-500"
                        />
                        <StatCard
                            title="å¹³å‡å®¢å–®åƒ¹"
                            value={`$${Math.round(statistics.averageOrderValue)}`}
                            subtitle="æ¯ç­†è¨‚å–®å¹³å‡é‡‘é¡"
                            icon="ğŸ“Š"
                            color="border-l-purple-500"
                        />
                        <StatCard
                            title="è¨‚å–®æ•¸é‡"
                            value={statistics.totalOrders}
                            subtitle="æˆåŠŸäº¤æ˜“è¨‚å–®æ•¸"
                            icon="ğŸ“¦"
                            color="border-l-orange-500"
                        />
                    </div>

                    {/* åœ–è¡¨å€åŸŸ */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        {/* ç‡Ÿæ¥­é¡è¶¨å‹¢åœ– */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥ç‡Ÿæ¥­é¡è¶¨å‹¢</h3>
                            <div className="h-80">
                                <canvas></canvas>
                            </div>
                        </div>

                        {/* å®¢æ•¸è¶¨å‹¢åœ– */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥å®¢æ•¸è¶¨å‹¢</h3>
                            <div className="h-80">
                                <canvas></canvas>
                            </div>
                        </div>
                    </div>

                    {/* æ¯æœˆç‡Ÿæ¥­é¡å’Œç†±é–€å•†å“ */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        {/* æ¯æœˆç‡Ÿæ¥­é¡ */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æœˆç‡Ÿæ¥­é¡</h3>
                            <div className="h-80">
                                <canvas></canvas>
                            </div>
                        </div>

                        {/* ç†±é–€å•†å“éŠ·å”® */}
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">ç†±é–€å•†å“éŠ·å”®æ’è¡Œ</h3>
                            <div className="h-80">
                                <canvas></canvas>
                            </div>
                        </div>
                    </div>

                    {/* è©³ç´°éŠ·å”®è¡¨æ ¼ */}
                    <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                        <h3 className="text-lg font-bold mb-4">å•†å“éŠ·å”®æ˜ç´°</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-50">
                                        <th className="border border-gray-200 p-3 text-left">æ’å</th>
                                        <th className="border border-gray-200 p-3 text-left">å•†å“åç¨±</th>
                                        <th className="border border-gray-200 p-3 text-center">éŠ·å”®æ•¸é‡</th>
                                        <th className="border border-gray-200 p-3 text-right">éŠ·å”®é‡‘é¡</th>
                                        <th className="border border-gray-200 p-3 text-right">ä½”æ¯”</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {statistics.popularItems.map((item, index) => (
                                        <tr key={index} className="hover:bg-gray-50">
                                            <td className="border border-gray-200 p-3 font-medium">#{index + 1}</td>
                                            <td className="border border-gray-200 p-3">
                                                <div className="flex items-center gap-2">
                                                    <span>{item.icon}</span>
                                                    <span>{item.name}</span>
                                                </div>
                                            </td>
                                            <td className="border border-gray-200 p-3 text-center">{item.quantity}</td>
                                            <td className="border border-gray-200 p-3 text-right">${item.revenue.toLocaleString()}</td>
                                            <td className="border border-gray-200 p-3 text-right">
                                                {statistics.totalRevenue > 0 
                                                    ? `${((item.revenue / statistics.totalRevenue) * 100).toFixed(1)}%`
                                                    : '0%'
                                                }
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                                <tfoot>
                                    <tr className="bg-gray-100 font-bold">
                                        <td className="border border-gray-200 p-3" colSpan="2">ç¸½è¨ˆ</td>
                                        <td className="border border-gray-200 p-3 text-center">
                                            {statistics.popularItems.reduce((sum, item) => sum + item.quantity, 0)}
                                        </td>
                                        <td className="border border-gray-200 p-3 text-right">${statistics.totalRevenue.toLocaleString()}</td>
                                        <td className="border border-gray-200 p-3 text-right">100%</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    {/* ç´¯è¨ˆæ•¸æ“š */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥ç´¯è¨ˆç‡Ÿæ¥­é¡</h3>
                            <div className="space-y-2 max-h-60 overflow-y-auto">
                                {Object.entries(statistics.dailyData)
                                    .sort(([a], [b]) => new Date(b) - new Date(a))
                                    .map(([date, data]) => (
                                        <div key={date} className="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span className="font-medium">{date}</span>
                                            <span className="text-green-600 font-bold">${data.revenue.toLocaleString()}</span>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>

                        <div className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
                            <h3 className="text-lg font-bold mb-4">æ¯æ—¥ç´¯è¨ˆå®¢æ•¸</h3>
                            <div className="space-y-2 max-h-60 overflow-y-auto">
                                {Object.entries(statistics.dailyData)
                                    .sort(([a], [b]) => new Date(b) - new Date(a))
                                    .map(([date, data]) => (
                                        <div key={date} className="flex justify-between items-center py-2 border-b border-gray-100">
                                            <span className="font-medium">{date}</span>
                                            <span className="text-blue-600 font-bold">{data.customers} äºº</span>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // è¨‚å–®å¡ç‰‡çµ„ä»¶
        const OrderCard = ({ order, onConfirm, onStatusUpdate, onPrint }) => {
            const [showConfirmModal, setShowConfirmModal] = useState(false);
            const [adminNotes, setAdminNotes] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);

            const formatDate = (dateString) => {
                try {
                    if (!dateString) return 'æœªè¨­å®š';
                    const date = new Date(dateString);
                    return isNaN(date.getTime()) ? dateString : date.toLocaleString('zh-TW');
                } catch {
                    return dateString || 'æœªè¨­å®š';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'confirmed': return 'bg-green-100 text-green-800 border-green-300';
                    case 'preparing': return 'bg-blue-100 text-blue-800 border-blue-300';
                    case 'ready': return 'bg-purple-100 text-purple-800 border-purple-300';
                    case 'completed': return 'bg-gray-100 text-gray-800 border-gray-300';
                    case 'cancelled': return 'bg-red-100 text-red-800 border-red-300';
                    case 'pending': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
                    default: return 'bg-gray-100 text-gray-800 border-gray-300';
                }
            };

            const getStatusText = (status) => {
                switch (status) {
                    case 'confirmed': return 'å·²ç¢ºèª';
                    case 'preparing': return 'è£½ä½œä¸­';
                    case 'ready': return 'å¯å–é¤';
                    case 'completed': return 'å·²å®Œæˆ';
                    case 'cancelled': return 'å·²å–æ¶ˆ';
                    case 'pending': return 'å¾…ç¢ºèª';
                    default: return status || 'æœªçŸ¥';
                }
            };

            const handleConfirm = async () => {
                if (isProcessing) return;
                setIsProcessing(true);
                try {
                    await onConfirm(order.orderId, adminNotes);
                    setShowConfirmModal(false);
                    setAdminNotes('');
                } catch (error) {
                    console.error('ç¢ºèªè¨‚å–®å¤±æ•—:', error);
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleStatusUpdate = async (newStatus) => {
                if (isProcessing) return;
                setIsProcessing(true);
                try {
                    await onStatusUpdate(order.orderId, newStatus);
                } catch (error) {
                    console.error('æ›´æ–°ç‹€æ…‹å¤±æ•—:', error);
                } finally {
                    setIsProcessing(false);
                }
            };

            const statusOptions = [
                { value: 'pending', label: 'å¾…ç¢ºèª', color: 'yellow' },
                { value: 'confirmed', label: 'å·²ç¢ºèª', color: 'green' },
                { value: 'preparing', label: 'è£½ä½œä¸­', color: 'blue' },
                { value: 'ready', label: 'å¯å–é¤', color: 'purple' },
                { value: 'completed', label: 'å·²å®Œæˆ', color: 'gray' },
                { value: 'cancelled', label: 'å·²å–æ¶ˆ', color: 'red' }
            ];

            return (
                <div className="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden animate-fade-in">
                    {/* è¨‚å–®æ¨™é ­ */}
                    <div className="bg-gray-50 px-4 py-3 border-b border-gray-200">
                        <div className="flex justify-between items-start">
                            <div className="flex-1">
                                <h3 className="font-bold text-lg break-words">{order.orderId || 'æœªæŒ‡å®šè¨‚å–®ç·¨è™Ÿ'}</h3>
                                <p className="text-sm text-gray-600 mt-1">
                                    {order.customerName || 'æœªæä¾›å§“å'} â€¢ {order.customerPhone || 'æœªæä¾›é›»è©±'}
                                </p>
                            </div>
                            <div className="text-right ml-4">
                                <span className={`px-3 py-1 rounded-full text-sm font-medium border ${getStatusColor(order.status)}`}>
                                    {getStatusText(order.status)}
                                </span>
                                <p className="text-sm text-gray-500 mt-1">
                                    {formatDate(order.createdAt)}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* è¨‚å–®å…§å®¹ */}
                    <div className="p-4">
                        <div className="mb-4">
                            <h4 className="font-semibold mb-2">è¨‚å–®å…§å®¹:</h4>
                            <div className="bg-gray-50 rounded-lg p-3">
                                <div className="space-y-2">
                                    {order.items.map((item, index) => (
                                        <div key={index} className="flex justify-between text-sm">
                                            <span className="flex-1">
                                                {item.icon} {item.name} 
                                                <span className="text-gray-500 ml-2">x{item.quantity}</span>
                                            </span>
                                            <span className="ml-4">
                                                ${item.price * item.quantity}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                                <div className="border-t mt-2 pt-2 font-bold">
                                    <div className="flex justify-between">
                                        <span>ç¸½é‡‘é¡:</span>
                                        <span>${order.totalAmount}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                            <div>
                                <p><strong>å–é¤æ™‚é–“:</strong> {formatDate(order.pickupTime)}</p>
                                <p><strong>å–é¤æ–¹å¼:</strong> {order.deliveryAddress ? 'å¤–é€' : 'è‡ªå–'}</p>
                                {order.deliveryAddress && (
                                    <p className="break-words"><strong>å¤–é€åœ°å€:</strong> {order.deliveryAddress}</p>
                                )}
                            </div>
                            <div>
                                <p><strong>ç¸½é‡‘é¡:</strong> <span className="text-green-600 font-bold">${order.totalAmount}</span></p>
                                {order.notes && (
                                    <p className="break-words"><strong>é¡§å®¢å‚™è¨»:</strong> {order.notes}</p>
                                )}
                            </div>
                        </div>

                        {order.adminNotes && (
                            <div className="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                                <p className="text-sm text-yellow-800 break-words">
                                    <strong>åº—å®¶å‚™è¨»:</strong> {order.adminNotes}
                                </p>
                            </div>
                        )}

                        {/* æ“ä½œæŒ‰éˆ• */}
                        <div className="flex flex-wrap gap-2">
                            {order.status === 'pending' && (
                                <button
                                    onClick={() => setShowConfirmModal(true)}
                                    disabled={isProcessing}
                                    className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                                >
                                    {isProcessing ? <LoadingSpinner /> : 'âœ…'}
                                    ç¢ºèªè¨‚å–®
                                </button>
                            )}
                            
                            <select
                                value={order.status || 'pending'}
                                onChange={(e) => handleStatusUpdate(e.target.value)}
                                disabled={isProcessing}
                                className="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"
                            >
                                {statusOptions.map(option => (
                                    <option key={option.value} value={option.value}>
                                        {option.label}
                                    </option>
                                ))}
                            </select>

                            <button
                                onClick={() => onPrint(order)}
                                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                            >
                                ğŸ–¨ï¸ åˆ—å°
                            </button>
                        </div>
                    </div>

                    {/* ç¢ºèªè¨‚å–®æ¨¡æ…‹æ¡† */}
                    {showConfirmModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg p-6 max-w-md w-full animate-fade-in">
                                <h3 className="text-lg font-bold mb-4">ç¢ºèªè¨‚å–®</h3>
                                <p className="mb-4">æ‚¨å³å°‡ç¢ºèªè¨‚å–® <strong>{order.orderId}</strong></p>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        åº—å®¶å‚™è¨» (å¯é¸)
                                    </label>
                                    <textarea
                                        value={adminNotes}
                                        onChange={(e) => setAdminNotes(e.target.value)}
                                        rows="3"
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        placeholder="è¼¸å…¥å‚™è¨»è³‡è¨Š..."
                                    />
                                </div>

                                <div className="flex justify-end gap-3">
                                    <button
                                        onClick={() => setShowConfirmModal(false)}
                                        disabled={isProcessing}
                                        className="px-4 py-2 text-gray-600 hover:text-gray-800 disabled:opacity-50"
                                    >
                                        å–æ¶ˆ
                                    </button>
                                    <button
                                        onClick={handleConfirm}
                                        disabled={isProcessing}
                                        className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                                    >
                                        {isProcessing ? <LoadingSpinner /> : null}
                                        ç¢ºèªè¨‚å–®
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ä¸»æ‡‰ç”¨çµ„ä»¶
        const App = () => {
            const [orders, setOrders] = useState([]);
            const [filteredOrders, setFilteredOrders] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [notification, setNotification] = useState({ message: '', type: 'success', visible: false });
            const [statusFilter, setStatusFilter] = useState('all');
            const [currentView, setCurrentView] = useState('orders');

            // è¼‰å…¥è¨‚å–®
            const loadOrders = async () => {
                try {
                    const result = await apiService.getAllOrders();
                    if (result.success) {
                        setOrders(result.data);
                        applyFilters(result.data, statusFilter);
                        showNotification(`æˆåŠŸè¼‰å…¥ ${result.data.length} ç­†è¨‚å–®`, 'success');
                    } else {
                        throw new Error(result.message || 'è¼‰å…¥è¨‚å–®å¤±æ•—');
                    }
                } catch (error) {
                    console.error('è¼‰å…¥è¨‚å–®å¤±æ•—:', error);
                    showNotification('è¼‰å…¥è¨‚å–®å¤±æ•—: ' + error.message, 'error');
                } finally {
                    setIsLoading(false);
                    setIsRefreshing(false);
                }
            };

            // æ‡‰ç”¨ç¯©é¸
            const applyFilters = (ordersList, filter) => {
                if (filter === 'all') {
                    setFilteredOrders(ordersList);
                } else {
                    setFilteredOrders(ordersList.filter(order => order.status === filter));
                }
            };

            useEffect(() => {
                loadOrders();
            }, []);

            useEffect(() => {
                applyFilters(orders, statusFilter);
            }, [statusFilter, orders]);

            const showNotification = useCallback((message, type = 'success', duration = 4000) => {
                setNotification({ message, type, visible: true });
                setTimeout(() => setNotification(prev => ({ ...prev, visible: false })), duration);
            }, []);

            // ç¢ºèªè¨‚å–®
            const handleConfirmOrder = async (orderId, adminNotes) => {
                try {
                    const result = await apiService.confirmOrder(orderId, adminNotes);
                    if (result.success) {
                        showNotification('è¨‚å–®å·²ç¢ºèªï¼', 'success');
                        await loadOrders();
                    } else {
                        throw new Error(result.message || 'ç¢ºèªè¨‚å–®å¤±æ•—');
                    }
                } catch (error) {
                    console.error('ç¢ºèªè¨‚å–®å¤±æ•—:', error);
                    showNotification('ç¢ºèªè¨‚å–®å¤±æ•—: ' + error.message, 'error');
                    throw error;
                }
            };

            // æ›´æ–°è¨‚å–®ç‹€æ…‹
            const handleStatusUpdate = async (orderId, status) => {
                try {
                    const result = await apiService.updateOrderStatus(orderId, status);
                    if (result.success) {
                        showNotification('è¨‚å–®ç‹€æ…‹å·²æ›´æ–°ï¼', 'success');
                        await loadOrders();
                    } else {
                        throw new Error(result.message || 'æ›´æ–°ç‹€æ…‹å¤±æ•—');
                    }
                } catch (error) {
                    console.error('æ›´æ–°ç‹€æ…‹å¤±æ•—:', error);
                    showNotification('æ›´æ–°ç‹€æ…‹å¤±æ•—: ' + error.message, 'error');
                    throw error;
                }
            };

            // ç‹€æ…‹ç¯©é¸é¸é …
            const statusFilters = [
                { value: 'all', label: 'å…¨éƒ¨è¨‚å–®', count: orders.length },
                { value: 'pending', label: 'å¾…ç¢ºèª', count: orders.filter(o => o.status === 'pending').length },
                { value: 'confirmed', label: 'å·²ç¢ºèª', count: orders.filter(o => o.status === 'confirmed').length },
                { value: 'preparing', label: 'è£½ä½œä¸­', count: orders.filter(o => o.status === 'preparing').length },
                { value: 'ready', label: 'å¯å–é¤', count: orders.filter(o => o.status === 'ready').length },
                { value: 'completed', label: 'å·²å®Œæˆ', count: orders.filter(o => o.status === 'completed').length },
                { value: 'cancelled', label: 'å·²å–æ¶ˆ', count: orders.filter(o => o.status === 'cancelled').length }
            ];

            // æ¸²æŸ“ç•¶å‰è¦–åœ–
            const renderCurrentView = () => {
                if (currentView === 'statistics') {
                    return <SalesStatistics orders={orders} currentView={currentView} onViewChange={setCurrentView} />;
                }

                return (
                    <div className="animate-fade-in">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">è¨‚å–®ç®¡ç†</h2>
                            <button
                                onClick={() => setCurrentView('statistics')}
                                className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors"
                            >
                                ğŸ“Š æŸ¥çœ‹éŠ·å”®çµ±è¨ˆ
                            </button>
                        </div>

                        {/* æ§åˆ¶é¢æ¿ */}
                        <div className="bg-white rounded-lg p-4 border border-gray-200 shadow-sm mb-6">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div className="flex flex-wrap gap-2">
                                    {statusFilters.map(filter => (
                                        <button
                                            key={filter.value}
                                            onClick={() => setStatusFilter(filter.value)}
                                            className={`px-4 py-2 rounded-lg border transition-colors ${
                                                statusFilter === filter.value
                                                    ? 'bg-blue-500 text-white border-blue-500'
                                                    : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                                            }`}
                                        >
                                            {filter.label} ({filter.count})
                                        </button>
                                    ))}
                                </div>
                                
                                <button
                                    onClick={loadOrders}
                                    disabled={isRefreshing}
                                    className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                                >
                                    {isRefreshing ? <LoadingSpinner /> : 'ğŸ”„'}
                                    {isRefreshing ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°è¨‚å–®'}
                                </button>
                            </div>
                        </div>

                        {/* è¨‚å–®åˆ—è¡¨ */}
                        {isLoading ? (
                            <div className="text-center py-12">
                                <LoadingSpinner />
                                <p className="mt-4 text-gray-600">è¼‰å…¥è¨‚å–®ä¸­...</p>
                            </div>
                        ) : filteredOrders.length === 0 ? (
                            <div className="text-center py-12">
                                <div className="text-4xl mb-4">ğŸ“‹</div>
                                <p className="text-gray-500 text-lg">æš«ç„¡è¨‚å–®</p>
                                <p className="text-gray-400">
                                    {statusFilter !== 'all' 
                                        ? `ç›®å‰æ²’æœ‰${statusFilters.find(f => f.value === statusFilter)?.label}çš„è¨‚å–®`
                                        : 'å°šæœªæ”¶åˆ°ä»»ä½•è¨‚å–®'}
                                </p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {filteredOrders.map((order, index) => (
                                    <OrderCard
                                        key={order.orderId || index}
                                        order={order}
                                        onConfirm={handleConfirmOrder}
                                        onStatusUpdate={handleStatusUpdate}
                                        onPrint={(order) => window.print()}
                                    />
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="container mx-auto px-4 py-6 max-w-7xl">
                        {/* æ¨™é ­ */}
                        <div className="mb-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">å°ç£å°åƒåº— - åº—å®¶ç®¡ç†ç³»çµ±</h1>
                            <p className="text-gray-600">
                                {currentView === 'orders' ? 'è¨‚å–®ç®¡ç†èˆ‡è¿½è¹¤' : 'éŠ·å”®çµ±è¨ˆèˆ‡åˆ†æ'}
                            </p>
                        </div>

                        {renderCurrentView()}
                    </div>

                    <Notification
                        message={notification.message}
                        type={notification.type}
                        visible={notification.visible}
                        onClose={() => setNotification(prev => ({ ...prev, visible: false }))}
                    />
                </div>
            );
        };

        // æ¸²æŸ“æ‡‰ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
