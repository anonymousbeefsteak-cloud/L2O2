<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å°ç£å°åƒåº— - LINE ç·šä¸Šè¨‚é¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#3498db',
              secondary: '#ff6b6b',
              success: '#27ae60',
              danger: '#e74c3c',
              light: '#f8f9fa',
              dark: '#343a40',
              neutral: '#f1f5f9',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
            },
            animation: {
              fadeIn: 'fadeIn 0.5s ease-out forwards',
            },
          },
        },
      }
    </script>
    <style>
      html { scroll-behavior: smooth; }
      body { font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif; }
    </style>
</head>
<body class="bg-neutral">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ==================== CONSTANTS ====================
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyvGq83H2r7mZxEHfHaEXOBm2B2U_rNlLc3Exio8Nq6cb8ULqfvf5wrb_b1wQgiVEZ0zA/exec"; // Replace with your Apps Script URL
        const LIFF_ID = '2008276630-bYNjwMx7';

        const MENU_ITEMS = [
            { id: 1, name: "æ»·è‚‰é£¯", price: 35, emoji: "ğŸœ", category: "ä¸»é£Ÿ" },
            { id: 2, name: "é›è‚‰é£¯", price: 40, emoji: "ğŸš", category: "ä¸»é£Ÿ" },
            { id: 3, name: "èšµä»”ç…", price: 65, emoji: "ğŸ¦ª", category: "å°åƒ" },
            { id: 4, name: "å¤§è…¸éºµç·š", price: 50, emoji: "ğŸ²", category: "æ¹¯å“" },
            { id: 5, name: "çç å¥¶èŒ¶", price: 45, emoji: "ğŸ¥¤", category: "é£²æ–™" },
            { id: 6, name: "é¹½é…¥é›", price: 60, emoji: "ğŸ—", category: "å°åƒ" },
            { id: 7, name: "ç”œä¸è¾£", price: 40, emoji: "ğŸŸ", category: "å°åƒ" },
            { id: 8, name: "èšµä»”é…¥", price: 70, emoji: "ğŸ¦ª", category: "å°åƒ" },
            { id: 9, name: "è‚‰åœ“", price: 45, emoji: "ğŸ¥Ÿ", category: "å°åƒ" },
            { id: 10, name: "ç¢—ç²¿", price: 35, emoji: "ğŸ®", category: "å°åƒ" }
        ];

        const getDefaultPickupTime = () => {
            const now = new Date();
            now.setMinutes(now.getMinutes() + 30);
            const hours = now.getHours();
            if (hours < 10) {
                now.setHours(10, 0, 0, 0);
            } else if (hours >= 22) {
                now.setDate(now.getDate() + 1);
                now.setHours(10, 0, 0, 0);
            }
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hour}:${minute}`;
        };

        // ==================== SERVICES ====================
        const submitOrder = async (orderData) => {
            try {
                console.log("é–‹å§‹æäº¤è¨‚å–®:", orderData);
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(orderData),
                    mode: 'cors',
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                const result = await response.json();
                console.log("è¨‚å–®æäº¤çµæœ:", result);
                return result;
            } catch (error) {
                console.error("æäº¤å¤±æ•—:", error);
                return { 
                    success: false, 
                    message: error.name === 'AbortError' ? 'è«‹æ±‚è¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚' : `æäº¤è¨‚å–®å¤±æ•—: ${error.message}` 
                };
            }
        };

        // ==================== HOOKS ====================
        const useLiff = () => {
            const [isLiffReady, setIsLiffReady] = useState(false);
            const [liffCustomerName, setLiffCustomerName] = useState('');
            const [liffUserId, setLiffUserId] = useState('');
            const [liffError, setLiffError] = useState('');

            useEffect(() => {
                const initializeLiff = async () => {
                    try {
                        if (!window.liff) throw new Error('LIFF SDK æœªæ‰¾åˆ°');
                        await window.liff.init({ liffId: LIFF_ID });
                        console.log('LIFF åˆå§‹åŒ–æˆåŠŸ');
                        if (window.liff.isLoggedIn()) {
                            const profile = await window.liff.getProfile();
                            setLiffCustomerName(profile.displayName);
                            setLiffUserId(profile.userId);
                            console.log('ç”¨æˆ¶è³‡æ–™åŠ è¼‰:', profile.displayName);
                        }
                    } catch (error) {
                        console.error('LIFF åˆå§‹åŒ–å¤±æ•—', error);
                        setLiffError(error.message);
                        setLiffCustomerName('é¡§å®¢');
                    } finally {
                        setIsLiffReady(true);
                    }
                };
                initializeLiff();
            }, []);

            return { isLiffReady, liffCustomerName, liffUserId, liffError };
        };

        // ==================== COMPONENTS ====================
        const LoadingSpinner = () => (
            <div className="min-h-screen flex flex-col justify-center items-center bg-white">
                <div className="inline-block w-12 h-12 border-4 border-t-blue-500 border-gray-200 rounded-full animate-spin"></div>
                <p className="mt-4 text-lg text-gray-700">æ­£åœ¨èˆ‡ LINE é€£æ¥ä¸­...</p>
            </div>
        );

        const Navbar = () => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [isScrolled, setIsScrolled] = useState(false);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const handleLinkClick = (e, targetId) => {
                e.preventDefault();
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const top = targetElement.offsetTop - 80;
                    window.scrollTo({ top, behavior: 'smooth' });
                    setIsMenuOpen(false);
                }
            };

            const navClass = isScrolled ? 'py-2 bg-white/95 backdrop-blur-sm' : 'py-3 bg-white';
            const navLinks = [
                { href: '#menu', text: 'èœå–®' },
                { href: '#order', text: 'ç·šä¸Šè¨‚é¤' },
                { href: '#contact', text: 'è¯çµ¡æˆ‘å€‘' },
            ];

            return (
                <nav className={`fixed w-full z-20 transition-all duration-300 shadow-md ${navClass}`}>
                    <div className="container mx-auto px-4 flex justify-between items-center">
                        <div className="flex items-center space-x-2">
                            <i className="fa-solid fa-utensils text-primary text-2xl"></i>
                            <h1 className="text-xl font-bold text-dark">å°ç£å°åƒåº—</h1>
                        </div>
                        <div className="hidden md:flex items-center space-x-6">
                            {navLinks.map(link => (
                                <a key={link.href} href={link.href} onClick={(e) => handleLinkClick(e, link.href)} className="hover:text-primary transition-colors">
                                    {link.text}
                                </a>
                            ))}
                        </div>
                        <button className="md:hidden text-xl text-dark" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                            <i className="fa-solid fa-bars"></i>
                        </button>
                    </div>
                    {isMenuOpen && (
                        <div className="md:hidden bg-white w-full border-t">
                            <div className="container mx-auto px-4 py-2 flex flex-col space-y-3">
                                {navLinks.map(link => (
                                    <a key={link.href} href={link.href} onClick={(e) => handleLinkClick(e, link.href)} className="py-2 hover:text-primary transition-colors">
                                        {link.text}
                                    </a>
                                ))}
                            </div>
                        </div>
                    )}
                </nav>
            );
        };

        const Header = () => {
            const handleOrderNowClick = (e) => {
                e.preventDefault();
                const orderSection = document.getElementById('order');
                if (orderSection) {
                    window.scrollTo({ top: orderSection.offsetTop - 80, behavior: 'smooth' });
                }
            };

            return (
                <header className="pt-24 md:pt-32 bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                    <div className="container mx-auto px-4 py-16 md:py-24 text-center md:text-left">
                        <div className="max-w-3xl">
                            <h2 className="text-3xl md:text-5xl font-bold mb-4 animate-fadeIn">ç¾å‘³ä¸ç”¨ç­‰ï¼Œç·šä¸Šè¨‚é¤æ›´è¼•é¬†</h2>
                            <p className="text-lg md:text-xl mb-8 opacity-90 animate-fadeIn" style={{ animationDelay: '0.2s' }}>
                                å¿«é€Ÿè¨‚è³¼æ‚¨å–œæ„›çš„å°ç£å°åƒï¼Œç¯€çœç­‰å¾…æ™‚é–“ï¼Œåˆ°åº—å³å¯å–é¤
                            </p>
                            <a href="#order" onClick={handleOrderNowClick} className="inline-block bg-white text-primary border-2 border-transparent py-3 px-8 rounded-full font-bold transition-all duration-300 hover:bg-transparent hover:text-white hover:border-white hover:shadow-lg active:scale-95 animate-fadeIn" style={{ animationDelay: '0.4s' }}>
                                ç«‹å³è¨‚é¤ <i className="fa-solid fa-arrow-right ml-2"></i>
                            </a>
                        </div>
                    </div>
                </header>
            );
        };

        const FeatureCard = ({ icon, title, description }) => (
            <div className="text-center p-6 rounded-lg shadow-sm bg-white">
                <div className="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i className={`fa-solid ${icon} text-primary text-2xl`}></i>
                </div>
                <h3 className="text-xl font-semibold mb-2">{title}</h3>
                <p className="text-gray-600">{description}</p>
            </div>
        );

        const Features = () => (
            <section className="py-12 bg-neutral">
                <div className="container mx-auto px-4">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <FeatureCard icon="fa-clock" title="ç¯€çœæ™‚é–“" description="ç·šä¸Šæå‰è¨‚é¤ï¼Œåˆ°åº—å³å¯å–é¤ï¼Œä¸ç”¨ç¾å ´ç­‰å€™" />
                        <FeatureCard icon="fa-cart-shopping" title="è¼•é¬†è¨‚è³¼" description="ç°¡å–®å¹¾æ­¥ï¼Œå®Œæˆè¨‚é¤ï¼Œæ”¯æŒå¤šç¨®é¤é»çµ„åˆ" />
                        <FeatureCard icon="fa-circle-check" title="è¨‚å–®ç¢ºèª" description="å³æ™‚æ”¶åˆ°è¨‚å–®ç¢ºèªï¼Œè¼•é¬†æŒæ¡å–é¤æ™‚é–“" />
                    </div>
                </div>
            </section>
        );

        const MenuItem = React.memo(({ item, onAddToOrder }) => (
            <div className="bg-white rounded-xl overflow-hidden shadow-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                <div className="p-5">
                    <div className="flex justify-between items-start mb-3">
                        <h3 className="text-lg font-semibold flex items-center text-dark">
                            <span className="text-2xl mr-2">{item.emoji}</span>
                            {item.name}
                        </h3>
                        <span className="text-lg font-bold text-primary">${item.price}</span>
                    </div>
                    <button className="w-full py-2 bg-primary/10 border border-primary/20 text-primary rounded-lg hover:bg-primary hover:text-white transition-colors font-semibold" onClick={() => onAddToOrder(item)}>
                        <i className="fa-solid fa-plus mr-1"></i> åŠ å…¥è¨‚å–®
                    </button>
                </div>
            </div>
        ));

        const Menu = ({ menuItems, onAddToOrder }) => (
            <section id="menu" className="py-16 bg-white">
                <div className="container mx-auto px-4">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold mb-4 text-dark">æˆ‘å€‘çš„èœå–®</h2>
                        <p className="text-gray-600 max-w-2xl mx-auto">ç²¾é¸é“åœ°å°ç£å°åƒï¼Œæ¯ä¸€é“éƒ½è®“æ‚¨å›å‘³ç„¡çª®</p>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {menuItems.map(item => (
                            <MenuItem key={item.id} item={item} onAddToOrder={onAddToOrder} />
                        ))}
                    </div>
                </div>
            </section>
        );

        const SuccessModal = ({ isOpen, orderId, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fadeIn">
                    <div className="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all duration-300">
                        <div className="text-center">
                            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i className="fa-solid fa-check text-2xl text-green-500"></i>
                            </div>
                            <h3 className="text-2xl font-bold mb-2 text-dark">è¨‚å–®æäº¤æˆåŠŸï¼</h3>
                            <p className="text-gray-600 mb-4">æ‚¨çš„è¨‚å–®å·²é †åˆ©æäº¤ï¼Œæˆ‘å€‘æœƒç›¡å¿«æº–å‚™æ‚¨çš„é¤é»ã€‚</p>
                            <div className="bg-gray-50 p-4 rounded-lg mb-6">
                                <p className="text-sm text-gray-500 mb-1">è¨‚å–®ç·¨è™Ÿ</p>
                                <p className="font-semibold text-lg text-dark">{orderId}</p>
                            </div>
                            <button onClick={onClose} className="w-full bg-primary text-white py-3 px-6 rounded-full font-medium transition-all duration-300 hover:bg-opacity-90 hover:shadow-lg active:scale-95">
                                å®Œæˆ
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const OrderSection = ({ orderItems, totalAmount, onUpdateQuantity, onRemoveItem, onFormSubmit, liffCustomerName, liffUserId }) => {
            const [formData, setFormData] = useState({
                customerName: '',
                customerPhone: '',
                pickupTime: getDefaultPickupTime(),
                notes: ''
            });
            const [errors, setErrors] = useState({});
            const [isLoading, setIsLoading] = useState(false);
            const [formError, setFormError] = useState('');

            useEffect(() => {
                if (liffCustomerName) {
                    setFormData(prev => ({ ...prev, customerName: liffCustomerName }));
                }
            }, [liffCustomerName]);

            const validateForm = () => {
                const newErrors = {};
                if (!formData.customerName.trim()) newErrors.customerName = 'è«‹è¼¸å…¥æ‚¨çš„å§“å';
                if (formData.customerName.trim().length < 2) newErrors.customerName = 'å§“åè‡³å°‘éœ€è¦2å€‹å­—å…ƒ';
                if (!/^09\d{8}$/.test(formData.customerPhone)) newErrors.customerPhone = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼ (09é–‹é ­ï¼Œå…±10ä½æ•¸å­—)';
                if (!formData.pickupTime || new Date(formData.pickupTime) <= new Date()) newErrors.pickupTime = 'è«‹é¸æ“‡æœªä¾†çš„å–é¤æ™‚é–“';
                if (orderItems.length === 0) {
                    setFormError('è«‹è‡³å°‘é¸æ“‡ä¸€é …é¤é»');
                    return false;
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
                if (errors[name]) setErrors(prev => ({ ...prev, [name]: '' }));
                if (formError) setFormError('');
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!validateForm()) return;
                setIsLoading(true);
                setFormError('');
                const orderData = {
                    ...formData,
                    items: orderItems,
                    totalAmount,
                    timestamp: new Date().toISOString(),
                    source: 'web_app_react_liff',
                    customerLineId: liffCustomerName || 'æœªæä¾›',
                    lineUserId: liffUserId || 'æœªæä¾›'
                };
                const result = await onFormSubmit(orderData);
                setIsLoading(false);
                if (result.success) {
                    setFormData({
                        customerName: liffCustomerName || '',
                        customerPhone: '',
                        pickupTime: getDefaultPickupTime(),
                        notes: ''
                    });
                    setErrors({});
                } else {
                    setFormError(result.message);
                }
            };

            return (
                <section id="order" className="py-16 bg-neutral">
                    <div className="container mx-auto px-4">
                        <div className="text-center mb-12">
                            <h2 className="text-3xl font-bold mb-4 text-dark">ç·šä¸Šè¨‚é¤</h2>
                            <p className="text-gray-600 max-w-2xl mx-auto">ç¢ºèªæ‚¨çš„è¨‚å–®è³‡è¨Šï¼Œå¿«é€Ÿåˆæ–¹ä¾¿</p>
                        </div>
                        <div className="max-w-2xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                            <form onSubmit={handleSubmit} noValidate className="space-y-6">
                                <div className="bg-gray-50 p-4 rounded-lg">
                                    <h3 className="text-lg font-semibold mb-3 text-dark">ğŸ½ï¸ æ‚¨çš„é¤é»</h3>
                                    <div className="space-y-3">
                                        {orderItems.length === 0 ? (
                                            <p className="text-center text-gray-500 py-4">å°šæœªé¸æ“‡ä»»ä½•é¤é»</p>
                                        ) : (
                                            orderItems.map(item => (
                                                <div key={item.id} className="flex justify-between items-center bg-white p-3 rounded-md shadow-sm">
                                                    <div>
                                                        <p className="font-medium text-sm md:text-base">{`${item.emoji} ${item.name}`}</p>
                                                        <p className="text-sm text-gray-500">{`$${item.price} x ${item.quantity} = $${item.price * item.quantity}`}</p>
                                                    </div>
                                                    <div className="flex items-center space-x-1 md:space-x-2">
                                                        <button type="button" onClick={() => onUpdateQuantity(item.id, item.quantity - 1)} className="w-7 h-7 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors">-</button>
                                                        <span className="w-8 text-center font-medium">{item.quantity}</span>
                                                        <button type="button" onClick={() => onUpdateQuantity(item.id, item.quantity + 1)} className="w-7 h-7 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors">+</button>
                                                        <button type="button" onClick={() => onRemoveItem(item.id)} className="w-7 h-7 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors"><i className="fa-solid fa-xmark"></i></button>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1" htmlFor="customerName">é¡§å®¢å§“å <span className="text-red-500">*</span></label>
                                    <input type="text" id="customerName" name="customerName" value={formData.customerName} onChange={handleChange} required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition" />
                                    {errors.customerName && <p className="text-red-500 text-sm mt-1">{errors.customerName}</p>}
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1" htmlFor="customerPhone">è¯çµ¡é›»è©± <span className="text-red-500">*</span></label>
                                    <input type="tel" id="customerPhone" name="customerPhone" value={formData.customerPhone} onChange={handleChange} required placeholder="0912345678" maxLength={10} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition" />
                                    {errors.customerPhone && <p className="text-red-500 text-sm mt-1">{errors.customerPhone}</p>}
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1" htmlFor="pickupTime">å–é¤æ™‚é–“ <span className="text-red-500">*</span></label>
                                    <input type="datetime-local" id="pickupTime" name="pickupTime" value={formData.pickupTime} onChange={handleChange} required min={new Date().toISOString().slice(0, 16)} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition" />
                                    {errors.pickupTime && <p className="text-red-500 text-sm mt-1">{errors.pickupTime}</p>}
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1" htmlFor="notes">è¨‚å–®å‚™è¨» (é¸å¡«)</label>
                                    <textarea id="notes" name="notes" rows={3} value={formData.notes} onChange={handleChange} placeholder="å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚è«‹åœ¨æ­¤å‚™è¨»..." className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition"></textarea>
                                </div>
                                <div className="bg-green-100/50 border border-green-200/80 p-4 rounded-lg text-lg font-bold flex justify-between items-center">
                                    <span className="text-green-800">ğŸ’° ç¸½é‡‘é¡:</span>
                                    <span className="text-green-800">${totalAmount}</span>
                                </div>
                                <button type="submit" className="w-full bg-primary text-white py-3 px-6 rounded-full font-bold text-lg transition-all duration-300 hover:bg-opacity-90 hover:shadow-lg active:scale-95 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled={isLoading || orderItems.length === 0}>
                                    {isLoading ? <><i className="fa-solid fa-spinner fa-spin text-xl mr-2"></i> è™•ç†ä¸­...</> : <><i className="fa-solid fa-paper-plane mr-2"></i> é€å‡ºè¨‚å–®</>}
                                </button>
                                {formError && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm flex items-center">
                                        <i className="fa-solid fa-circle-exclamation mr-2"></i>
                                        <span>{formError}</span>
                                    </div>
                                )}
                            </form>
                        </div>
                    </div>
                </section>
            );
        };

        const FAQItem = ({ question, answer }) => (
            <div>
                <h4 className="font-medium flex items-center">
                    <i className="fa-solid fa-circle-question text-primary mr-2"></i>
                    {question}
                </h4>
                <p className="text-gray-600 text-sm mt-1">{answer}</p>
            </div>
        );

        const Contact = () => (
            <section id="contact" className="py-16 bg-white">
                <div className="container mx-auto px-4">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold mb-4 text-dark">è¯çµ¡æˆ‘å€‘</h2>
                        <p className="text-gray-600">å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œæ­¡è¿éš¨æ™‚è¯ç¹«æˆ‘å€‘</p>
                    </div>
                    <div className="max-w-4xl mx-auto">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="bg-neutral p-6 rounded-xl shadow-sm">
                                <h3 className="text-xl font-semibold mb-4 text-dark">åº—èˆ–è³‡è¨Š</h3>
                                <div className="space-y-4">
                                    <div className="flex items-start"><i className="fa-solid fa-location-dot text-primary mt-1 mr-3"></i><p className="text-dark">è‡ºåŒ—å¸‚ä¿¡ç¾©å€æ¾å£½è·¯123è™Ÿ</p></div>
                                    <div className="flex items-start"><i className="fa-solid fa-phone text-primary mt-1 mr-3"></i><p className="text-dark">02-1234-5678</p></div>
                                    <div className="flex items-start"><i className="fa-solid fa-clock text-primary mt-1 mr-3"></i><p className="text-dark">ç‡Ÿæ¥­æ™‚é–“: 10:00 - 22:00</p></div>
                                </div>
                                <div className="mt-6">
                                    <h4 className="font-medium mb-2 text-dark">é—œæ³¨æˆ‘å€‘</h4>
                                    <div className="flex space-x-4">
                                        <a href="#" className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary hover:text-white transition-colors"><i className="fa-brands fa-facebook-f"></i></a>
                                        <a href="#" className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary hover:text-white transition-colors"><i className="fa-brands fa-instagram"></i></a>
                                        <a href="#" className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary hover:text-white transition-colors"><i className="fa-brands fa-line"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-neutral p-6 rounded-xl shadow-sm">
                                <h3 className="text-xl font-semibold mb-4 text-dark">å¸¸è¦‹å•é¡Œ</h3>
                                <div className="space-y-4">
                                    <FAQItem question="ç·šä¸Šè¨‚å–®éœ€è¦æå‰å¤šä¹…è¨‚è³¼ï¼Ÿ" answer="å»ºè­°æå‰è‡³å°‘15-30åˆ†é˜è¨‚è³¼ï¼Œä»¥ä¾¿æˆ‘å€‘æº–å‚™æ–°é®®ç¾å‘³çš„é¤é»ã€‚" />
                                    <FAQItem question="å¦‚ä½•å–æ¶ˆæˆ–ä¿®æ”¹è¨‚å–®ï¼Ÿ" answer="è«‹è‡´é›»æˆ‘å€‘çš„åº—èˆ–é›»è©±ï¼Œæä¾›æ‚¨çš„è¨‚å–®ç·¨è™Ÿé€²è¡Œä¿®æ”¹æˆ–å–æ¶ˆã€‚" />
                                    <FAQItem question="å¯ä»¥æŒ‡å®šå–é¤æ™‚é–“å—ï¼Ÿ" answer="ç•¶ç„¶å¯ä»¥ï¼Œè¨‚è³¼æ™‚è«‹é¸æ“‡æ‚¨æ–¹ä¾¿çš„å–é¤æ™‚é–“ï¼Œæˆ‘å€‘æœƒæº–æ™‚æº–å‚™å¥½ã€‚" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        );

        const Footer = () => (
            <footer className="bg-dark text-white py-8">
                <div className="container mx-auto px-4 text-center">
                    <div className="flex items-center justify-center space-x-2 mb-4">
                        <i className="fa-solid fa-utensils text-primary"></i>
                        <h2 className="text-xl font-bold">å°ç£å°åƒåº—</h2>
                    </div>
                    <p className="text-gray-400 mb-4">é“åœ°å°ç£å‘³ï¼Œæ»¿è¶³æ‚¨çš„å‘³è•¾</p>
                    <p className="text-gray-500 text-sm">Â© 2025 å°ç£å°åƒåº— ç‰ˆæ¬Šæ‰€æœ‰</p>
                </div>
            </footer>
        );

        // ==================== APP ====================
        const App = () => {
            const [orderItems, setOrderItems] = useState([]);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [submittedOrderId, setSubmittedOrderId] = useState('');
            const { isLiffReady, liffCustomerName, liffUserId, liffError } = useLiff();

            const totalAmount = useMemo(() => {
                return orderItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
            }, [orderItems]);

            const handleAddToOrder = useCallback((itemToAdd) => {
                setOrderItems(prevItems => {
                    const existingItem = prevItems.find(item => item.id === itemToAdd.id);
                    if (existingItem) {
                        return prevItems.map(item =>
                            item.id === itemToAdd.id
                                ? { ...item, quantity: item.quantity + 1 }
                                : item
                        );
                    }
                    return [...prevItems, { ...itemToAdd, quantity: 1 }];
                });
            }, []);

            const handleUpdateQuantity = useCallback((itemId, newQuantity) => {
                if (newQuantity < 1) {
                    setOrderItems(prevItems => prevItems.filter(item => item.id !== itemId));
                } else {
                    setOrderItems(prevItems =>
                        prevItems.map(item =>
                            item.id === itemId
                                ? { ...item, quantity: newQuantity }
                                : item
                        )
                    );
                }
            }, []);

            const handleRemoveItem = useCallback((itemId) => {
                setOrderItems(prevItems => prevItems.filter(item => item.id !== itemId));
            }, []);

            const handleFormSubmit = async (formData) => {
                const result = await submitOrder(formData);
                if (result.success && result.orderId) {
                    const pickupDate = new Date(formData.pickupTime).toLocaleString('zh-TW');
                    if (window.liff && window.liff.isInClient()) {
                        const lineMessage = `ğŸ‰ æ‚¨çš„è¨‚å–®å·²æˆç«‹ï¼\n----------------------\né¤é»ï¼š${formData.items.map(item => `${item.name} x${item.quantity}`).join(', ')}\nç¸½é‡‘é¡ï¼š$${totalAmount}\nå§“åï¼š${formData.customerName}\né›»è©±ï¼š${formData.customerPhone}\nå–é¤æ™‚é–“ï¼š${pickupDate}\nè¨‚å–®ç·¨è™Ÿï¼š${result.orderId}\nå‚™è¨»ï¼š${formData.notes || 'ç„¡'}\n----------------------\næ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼`;
                        try {
                            await window.liff.sendMessages([{ type: 'text', text: lineMessage }]);
                            setTimeout(() => {
                                window.liff.closeWindow();
                            }, 1000);
                        } catch (error) {
                            console.error("ç™¼é€ LINE æ¶ˆæ¯å¤±æ•—", error);
                            setSubmittedOrderId(result.orderId);
                            setIsModalOpen(true);
                        }
                    } else {
                        setSubmittedOrderId(result.orderId);
                        setIsModalOpen(true);
                    }
                    setOrderItems([]);
                    return { success: true, message: 'æˆåŠŸ' };
                } else {
                    return { success: false, message: result.message || 'è¨‚å–®æäº¤å¤±æ•—' };
                }
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setSubmittedOrderId('');
            };

            if (!isLiffReady) {
                return <LoadingSpinner />;
            }

            return (
                <div className="animate-fadeIn">
                    <Navbar />
                    <main>
                        <Header />
                        <Features />
                        <Menu menuItems={MENU_ITEMS} onAddToOrder={handleAddToOrder} />
                        <OrderSection
                            orderItems={orderItems}
                            totalAmount={totalAmount}
                            onUpdateQuantity={handleUpdateQuantity}
                            onRemoveItem={handleRemoveItem}
                            onFormSubmit={handleFormSubmit}
                            liffCustomerName={liffCustomerName}
                            liffUserId={liffUserId}
                        />
                        <Contact />
                    </main>
                    <Footer />
                    <SuccessModal
                        isOpen={isModalOpen}
                        orderId={submittedOrderId}
                        onClose={closeModal}
                    />
                </div>
            );
        };

        // ==================== RENDER ====================
        const rootElement = document.getElementById('root');
        if (rootElement) {
            const root = ReactDOM.createRoot(rootElement);
            root.render(<App />);
        }
    </script>
</body>
</html>
